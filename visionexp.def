Bootstrap: docker
From: pytorch/pytorch:2.3.1-cuda11.8-cudnn9-runtime

%post
    apt-get update && apt-get install -y \
        git \
        && rm -rf /var/lib/apt/lists/*

    # Create a virtualenv *inside* the container
    python -m venv /opt/venv
    . /opt/venv/bin/activate

    pip install --upgrade pip
    pip install -r /tmp/requirements.txt

%files
    requirements.txt /tmp/requirements.txt

%environment
    export VIRTUAL_ENV=/opt/venv
    export PATH=/opt/venv/bin:$PATH

%runscript
    # Default: when you do "singularity run visionexp.sif script.py"
    exec python "$@"